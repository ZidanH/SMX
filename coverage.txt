# 教程https://blog.csdn.net/Emmett_Bioinfo/article/details/115705002
conda activate RNA-seq
cd /data/home/DXQ/SMX_WQ
# 组装后没有分箱的所有contig
# 建库
bowtie2-build --thread 40 final.contigs.fa all_contig_build
# 生成sam文件，需要fastq，不能跑多个线程
bowtie2 -x all_contig_build -1 ALL_READS_1.fastq -2 ALL_READS_2.fastq -S all_contig.sam --threads 1 
# sam to bam
samtools view -bS all_contig.sam > all_contig.bam
# bam文件排序，生成bai文件
samtools sort  all_contig.bam -o all_contig_sorted.bam
samtools index all_contig_sorted.bam

# 将fasta, sorted.bam, sorted.bam.bai文件放入一个文件夹中checkM_all
# 计算每个contig在宏基因中的覆盖率
checkm coverage checkM_all/ all_coverage.out checkM_all/all_contig_sorted.bam -x fasta -m 20
# 将fasta文件换为bin文件，可计算bin中的contig在宏基因中的覆盖率，如
checkm coverage checkM_all/ SDB6_meta_coverage.out checkM_all/all_contig_sorted.bam -x fasta -m 20

# bin文件没有对应的fastaq/raw reads，无法进行第二步生成sam文件